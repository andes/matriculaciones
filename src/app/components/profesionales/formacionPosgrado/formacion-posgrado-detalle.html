<plex-box type="invert">

  <plex-title titulo="Detalle especialidad" size="lg">
    <plex-button type="warning" size="sm" (click)="editar()"> EDITAR</plex-button>
    <plex-button class='ml-2' type="danger" size="sm" [icon]="'close'" (click)="cerrar()"></plex-button>
  </plex-title>

  <plex-detail size="md" direction="row">
    <plex-icon name="credencial-paciente" type="info"></plex-icon>
    <div title>{{formacion.especialidad.nombre}} | {{ formacion.matriculacion[formacion.matriculacion.length -
      1].matriculaNumero }}
    </div>
    <div subtitle>{{formacion.institucionFormadora?.nombre}}</div>
    <plex-badge size="lg" type="info">
      ALTA: {{formacion.fechasDeAltas[formacion.fechasDeAltas.length - 1].fecha |
      date:'dd/MM/yyyy'}}
    </plex-badge>

    <plex-badge *ngIf="formacion.matriculacion.length && !formacion.revalida && formacion.tieneVencimiento && hoy > formacion.matriculacion[formacion.matriculacion.length-1].fin"
                type="{{((hoy.getTime() - formacion.matriculacion[formacion.matriculacion.length-1].fin.getTime())/(1000 * 3600 * 24) > 365)?'danger':'info'}}">
      {{((hoy.getTime() -
      formacion.matriculacion[formacion.matriculacion.length-1].fin.getTime())/(1000 * 3600
      *24) > 365)?'Vencida':'Año de gracia'}}
    </plex-badge>

    <plex-badge *ngIf="formacion.matriculacion.length && !formacion.revalida && formacion.tieneVencimiento &&
        formacion.matriculado && hoy < formacion.matriculacion[formacion.matriculacion.length-1].fin" type="success">
      vigente
    </plex-badge>

    <plex-badge *ngIf="formacion.matriculacion.length && !formacion.revalida && formacion.tieneVencimiento && 
        !formacion.matriculado" type="danger"> Suspendida
    </plex-badge>

    <plex-badge *ngIf='formacion.matriculacion.length  && formacion.revalida && formacion.tieneVencimiento'
                type="{{formacion.papelesVerificados?'info':'warning'}}">
      {{formacion.papelesVerificados?'Papeles verificados': 'Papeles sin verificar'}}
    </plex-badge>

    <plex-badge *ngIf='!formacion.tieneVencimiento' type="warning">
      Sin vencimiento
    </plex-badge>

    <plex-label titulo="Profesión" subtitulo="{{ formacion.profesion.nombre }}"></plex-label>
    <plex-label titulo="Libro" subtitulo="{{ formacion.matriculacion[formacion.matriculacion.length - 1].libro}}">
    </plex-label>
    <plex-label titulo="Folio" subtitulo="{{ formacion.matriculacion[formacion.matriculacion.length - 1].folio}}">
    </plex-label>
    <plex-label titulo="Modalidad" subtitulo="{{ formacion.certificacion?.modalidad.nombre }}"></plex-label>
  </plex-detail>

  <plex-title titulo="Notas" size="lg"></plex-title>

  <plex-label>{{formacion.notas}}</plex-label>
  <br>

  <plex-title titulo="Revalidaciones" size="lg"></plex-title>

  <div class="row">
    <div class="col-12">
      <plex-table [columns]="revalidaciones" #table="plTable">

        <tr *ngFor="let matriculacion of formacion.matriculacion; let i = index">
          <td>{{ matriculacion.revalidacionNumero }}</td>
          <td>{{ matriculacion.matriculaNumero }}</td>
          <td>
            <plex-badge size="lg" type="info">
              {{ matriculacion.inicio | date: 'dd/MM/yyyy'}}
            </plex-badge>
          </td>
          <td>
            <plex-badge *ngIf='i !== (formacion.matriculacion.length - 1) || formacion.tieneVencimiento ' size="lg"
                        type="warning">{{ matriculacion.fin | date: 'dd/MM/yyyy'}}
            </plex-badge>
            <plex-badge *ngIf='i === (formacion.matriculacion.length - 1) && !formacion.tieneVencimiento' size="lg"
                        type="warning"> Sin vencimiento
            </plex-badge>
          </td>
          <td>
            <plex-badge *ngIf='(i === (formacion.matriculacion.length - 1) && formacion.matriculado) ' size="lg"
                        type="{{(matriculacion.fin >= hoy || ((hoy.getTime() - formacion.matriculacion[formacion.matriculacion.length-1].fin.getTime())/(1000 * 3600 * 24) < 365))?'success':'danger'}}">
              {{(matriculacion.fin >= hoy && formacion.matriculado) || ((hoy.getTime() -
              formacion.matriculacion[formacion.matriculacion.length-1].fin.getTime())/(1000 * 3600 * 24) <
                365)? 'Vigente' :'Vencida'}} </plex-badge>

                <plex-badge *ngIf='i !== (formacion.matriculacion.length - 1) || !formacion.matriculado' size="lg"
                            type="danger"> NO VIGENTE
                </plex-badge>
          </td>
        </tr>
      </plex-table>
    </div>
  </div>
  <br>

  <plex-title titulo="Fechas de altas" size="lg">
  </plex-title>
  <div class="row">
    <div class="col-12">
      <plex-table [columns]="columns" #table="plTable">
        <plex-table-columns>
        </plex-table-columns>
        <tr *ngFor="let unaFecha of formacion.fechasDeAltas;let i = index">
          <td>{{ unaFecha.fecha | date: 'dd/MM/yyyy' }}</td>
        </tr>
      </plex-table>
      <br>
    </div>
  </div>
</plex-box>